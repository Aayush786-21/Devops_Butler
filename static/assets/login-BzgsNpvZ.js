import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */let m=!0;document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("toggleLink");n&&n.addEventListener("click",t=>{t.preventDefault(),w()}),I(),E(),P()});function w(){const n=document.getElementById("loginForm"),t=document.getElementById("registerForm"),e=document.getElementById("toggleText"),s=document.getElementById("toggleLink");m?(n.style.display="none",t.style.display="block",e.textContent="Already have an account? ",s.textContent="Sign in",m=!1):(t.style.display="none",n.style.display="block",e.textContent="Don't have an account? ",s.textContent="Sign up",m=!0),p()}function p(){document.getElementById("loginError").style.display="none",document.getElementById("registerError").style.display="none",document.getElementById("registerSuccess").style.display="none"}function d(n,t="info"){console.log(`[${t.toUpperCase()}] ${n}`);const e=document.getElementById("toast");e&&(e.textContent=n,e.className=`toast toast-${t}`,e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3))}function u(n,t,e,s="Loading...",a=""){const i=document.getElementById(n),o=document.getElementById(t);e?(i.disabled=!0,o.textContent=s):(i.disabled=!1,o.textContent=a)}function I(){const n=document.getElementById("loginForm");n&&n.addEventListener("submit",async s=>{var g,r;s.preventDefault();const a=(g=document.getElementById("loginUsername"))==null?void 0:g.value,i=(r=document.getElementById("loginPassword"))==null?void 0:r.value,o=document.getElementById("loginError");if(!a||!i){o&&(o.textContent="Please enter both username and password.",o.style.display="block");return}o&&(o.style.display="none"),u("loginBtn","loginBtnText",!0,"Signing In...","Sign In");try{const c=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:i})}),l=await c.json();if(c.ok){localStorage.setItem("access_token",l.access_token),localStorage.setItem("authToken",l.access_token),localStorage.setItem("username",l.username),localStorage.setItem("authProvider","local"),d("Login successful! Redirecting...","success");const h=new URLSearchParams(window.location.search).get("redirect")||"/";setTimeout(()=>{window.location.href=h},1e3)}else o&&(o.textContent=l.detail||"Login failed. Please try again.",o.style.display="block")}catch(c){console.error("Login error:",c),o&&(o.textContent="Network error. Please try again.",o.style.display="block")}finally{u("loginBtn","loginBtnText",!1,"Signing In...","Sign In")}});const t=document.getElementById("registerForm");t&&t.addEventListener("submit",async s=>{s.preventDefault();const a=document.getElementById("registerUsername").value,i=document.getElementById("registerEmail").value,o=document.getElementById("registerPassword").value,g=document.getElementById("registerConfirmPassword").value,r=document.getElementById("registerError"),c=document.getElementById("registerSuccess");if(r&&(r.style.display="none"),c&&(c.style.display="none"),o!==g){r&&(r.textContent="Passwords do not match.",r.style.display="block");return}if(o.length<6){r&&(r.textContent="Password must be at least 6 characters long.",r.style.display="block");return}u("registerBtn","registerBtnText",!0,"Creating Account...","Create Account");try{const l=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,email:i,password:o})}),f=await l.json();l.ok?(c&&(c.textContent="Account created successfully! You can now sign in.",c.style.display="block"),t.reset(),setTimeout(()=>{w()},2e3)):r&&(r.textContent=f.detail||"Registration failed. Please try again.",r.style.display="block")}catch(l){console.error("Registration error:",l),r&&(r.textContent="Network error. Please try again.",r.style.display="block")}finally{u("registerBtn","registerBtnText",!1,"Creating Account...","Create Account")}});const e=document.getElementById("githubLoginBtn");e&&e.addEventListener("click",async()=>{try{const s=await fetch("/api/auth/github"),a=await s.json();s.ok&&a.auth_url?window.location.href=a.auth_url:d("GitHub OAuth is not configured. Please contact administrator.","error")}catch(s){console.error("GitHub OAuth error:",s),d("Failed to initiate GitHub login","error")}})}function E(){const n=document.getElementById("loginPasswordToggle"),t=document.getElementById("loginPassword");n&&t&&n.addEventListener("click",()=>{y(t,n)});const e=document.getElementById("registerPasswordToggle"),s=document.getElementById("registerPassword");e&&s&&e.addEventListener("click",()=>{y(s,e)});const a=document.getElementById("registerConfirmPasswordToggle"),i=document.getElementById("registerConfirmPassword");a&&i&&a.addEventListener("click",()=>{y(i,a)})}function y(n,t){n.type==="password"?(n.type="text",t.textContent="ðŸ™ˆ",t.title="Hide password"):(n.type="password",t.textContent="ðŸ‘ï¸",t.title="Show password")}function k(){const t=new URLSearchParams(window.location.search).get("code");t&&fetch(`/api/auth/github/callback?code=${t}`).then(e=>e.json()).then(e=>{if(e.access_token){localStorage.setItem("access_token",e.access_token),localStorage.setItem("authToken",e.access_token),localStorage.setItem("username",e.username),localStorage.setItem("authProvider",e.auth_provider),d("GitHub login successful! Redirecting...","success");const a=new URLSearchParams(window.location.search).get("redirect")||"/";setTimeout(()=>{window.location.href=a},1e3)}else d("GitHub authentication failed","error")}).catch(e=>{console.error("GitHub callback error:",e),d("GitHub authentication failed","error")})}function P(){if(localStorage.getItem("access_token")||localStorage.getItem("authToken")){const e=new URLSearchParams(window.location.search).get("redirect")||"/";window.location.href=e}else k()}
