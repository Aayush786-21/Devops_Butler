# DevOps Butler - Codebase Location Guide
# Last Updated: 2025-11-03

## Recent Updates (Latest Session)

### New Features - Environment Variable Detection
- **Smart Detection**: Automatically detects env vars from repository code before deployment
- **Detection Dialog**: Shows detected vars with 3 options: Import All, Add Manually, No Skip
- **Pattern Matching**: Detects vars from process.env, os.getenv, os.environ, etc.
- **Built-in Filter**: Ignores common system vars (NODE_ENV, PATH, HOME, etc.)
- **Auto-Import**: One-click import of all detected vars with empty values
- **Multi-Repo Support**: Scans both frontend and backend repos for vars
- **Config File Priority**: Prioritizes vars found in next.config, .env.example, etc.
- **Node.js Deployment Fix**: Deployment now warns about missing env vars instead of failing

### UI/UX Improvements
- **Settings Page Redesign**: Modern layout with profile picture, password modal, toast notifications
- **Avatar Storage**: Moved from `static/avatars/` to `uploads/avatars/` to prevent deletion on frontend rebuild
- **Logo Update**: Replaced "DB" text with devops.png image in all sidebars
- **Terminology Update**: All user-facing "split repository" → "multi-repository" (internal code unchanged for compatibility)

### Bug Fixes
- **Split Repo Deletion**: Fixed cascade deletion of child components when deleting parent
- **Avatar Disappearance**: Fixed avatars being deleted when running npm build (moved to uploads/)
- **2FA Removal**: Removed non-functional 2FA section from Settings page
- **Node.js Deployment**: Fixed deployment failing when env vars are missing (now continues with warning)

### Other New Features
- **Password Modal**: Added change password modal with real-time strength indicator
- **Toast Notifications**: Added success/error/info toast system for user feedback
- **Avatar Management**: Profile picture upload, display, removal with persistent storage

### Environment Variables Simplification
- **Removed Project Selector**: No more dropdown to switch between projects
- **Current Project Only**: Env vars page only shows/manages vars for currently selected project
- **No Global Variables**: Removed "All Projects (Global)" option - all vars are project-specific
- **Clearer UX**: Users must select a project from Projects page to manage its env vars

## Frontend Files

### Main Application
- **Main HTML**: `frontend/src/index.html` - Single page application with all pages
- **Main JavaScript**: `frontend/src/js/app.js` - Client-side routing, project management, API calls
- **Main Styles**: `frontend/src/css/styles.css` - All CSS styles including modals, buttons, cards
- **Built Output**: `static/` directory - Production build output served by FastAPI

### Key Frontend Functions
- **Delete Project**: `frontend/src/js/app.js` - `deleteProject(projectId)` function at line ~128
- **Delete Confirmation Dialog**: `frontend/src/js/app.js` - `showDeleteConfirmation(projectName)` at line ~182 (simple minimal dialog)
- **Multi-Repository Import Dialog**: `frontend/src/js/app.js` - `showSplitImportDialog()` at line ~2967
  - **User-Facing Text**: "Import as Multi-Repository?"
  - **Internal**: Still uses split-* CSS classes and split API calls
- **Project Name Modal**: `frontend/src/js/app.js` - `openProjectNameModal()` at line ~1519
- **Project Logs Modal**: `frontend/src/js/app.js` - `showProjectLogsModal()` at line ~889
- **Project Components Display**: `frontend/src/js/app.js` - `loadAndDisplayProjectComponents()` at line ~1599
  - **Location**: ALWAYS displayed on Deploy page ONLY (never on Configuration page)
  - **Visibility**: Only shown when BOTH frontend AND backend are deployed (not just imported) AND deploy page is visible
  - **Animation**: Slides in with fade, pushes deploy card down smoothly
  - **CSS**: `.project-components-card` with `.components-visible` class (line ~2480)
  - **Auto-refresh**: Refreshes after successful deployment for multi-repos
  - **Key Fix**: Function checks `deployPage.style.display !== 'none'` before showing components section
  - **Configuration Page**: Explicitly hides components section (line ~1581-1584)
- **Settings Management**: `frontend/src/js/app.js` - `loadSettings()`, `setupSettingsListeners()`, `handleProfileUpdate()`, `handlePasswordUpdate()`
  - **Password Modal**: Change password with real-time strength indicator (red/orange/green)
  - **Avatar Upload/Remove**: Profile picture management in `uploads/avatars/`
  - **Toast Notifications**: Success/error/info messages for actions
- **Environment Variables Management**: `frontend/src/js/app.js` - `loadEnvVars()`, `saveEnvVars()`, `setupEnvVarsListeners()`
  - **No Project Selector**: Removed dropdown - uses `currentProject.id` exclusively
  - **Current Project Only**: Shows/manages vars for currently selected project only
  - **Import/Export**: Import from .env file, add/edit/delete variables
  - **Location**: Accessible via project sidebar → Environment Variables
- **Environment Variable Detection**: `frontend/src/js/app.js` - `showEnvVarsDetectionDialog()` at line ~1973
  - **Pre-Deploy Detection**: Automatically detects env vars from code when clicking "Deploy All"
  - **Detection Dialog**: Shows 3 options: Import All (auto-saves), Add Manually (navigates to env vars page), No Skip (proceeds)
  - **Auto-Import**: Merges detected vars with existing ones, saves to current project
  - **Integration**: Called in "Deploy All" button handler at line ~1389-1403
  - **API**: Uses `/api/env-vars/detect` endpoint with frontend_url & backend_url params
- **Multi-Repository Detection**: `frontend/src/js/app.js` - In `loadProjects()` function at line ~759
  - **Detection Logic**: Checks `git_url.startsWith('split::')` as most reliable method (works before and after deployment)
  - **Project Type**: Sets `project_type: 'split'` or `'single'` explicitly in project object
  - **Fallback**: Also checks status `'imported_split'` and parent_project_id for compatibility
  - **URL Parsing**: Extracts `frontend_url` and `backend_url` from `split::{frontend}|{backend}` format
- **Deploy Page Logic**: `frontend/src/js/app.js` - `showProjectContent('deploy')` at line ~1190
  - **Key Fix**: Always shows deploy page when clicking project (not configuration or components page)
  - **Project Type Detection**: Double-checks `git_url` format even if `project_type` is set
  - **Multi-Repos**: Shows multi layout (frontend/backend inputs) when `project_type === 'split'`
  - **Single Repos**: Shows single URL input when `project_type === 'single'`
  - **New Deploy**: Shows dropdown only when `currentProject` is null (from "+ New Deploy" button)
  - **Critical Fix**: Navigation between pages now reloads fresh project data to prevent stale state
- **Project Selection**: `frontend/src/js/app.js` - `selectProject(projectId)` at line ~1035
  - **Behavior**: Reloads projects before showing sidebar to ensure fresh data
  - **Initial Page**: Always calls `showProjectContent('deploy')` to show deploy page first
- **Navigation Fix**: `frontend/src/js/app.js` - Project sidebar navigation at line ~1145
  - **Critical Fix**: Project navigation now async reloads fresh data before showing page content
  - **Prevents**: Stale project data causing wrong deploy layout after deployment
  - **Flow**: await loadProjects() → update currentProject → showProjectContent(page)
- **Multi-Repository Deploy Button**: `frontend/src/js/app.js` - "Deploy All" button handler at line ~1348
  - **Critical Fix**: Changed from sequential `deploySingle()` calls to proper `/deploy` with `deploy_type='split'`
  - **Why**: Ensures proper parent/child relationship and uses `run_split_deployment()`
  - **Previous Bug**: Deployed as separate projects instead of linked components

### Frontend UI Components
- **Delete Button CSS**: `frontend/src/css/styles.css` - `.btn-delete` at line ~2109
- **Delete Confirmation Modal CSS**: `frontend/src/css/styles.css` - `.modal-overlay`, `.delete-confirmation-modal` at line ~1244
- **Project Cards**: `frontend/src/js/app.js` - `renderProjects()` at line ~806
- **Project Footer**: `frontend/src/js/app.js` - In `renderProjects()` template at line ~855

## Backend Files

### Core Application
- **Main FastAPI App**: `orchestrator.py` - Entry point, routes, WebSocket handlers
- **Database Models**: `login.py` - User, Deployment, EnvironmentVariable models
- **Database Setup**: `database.py` - Database engine, migrations, session management
- **Deployment Pipeline**: `simple_pipeline.py` - Core deployment logic

### API Endpoints (orchestrator.py)
- **Health Check**: `GET /health` - Line ~252
- **Deploy**: `POST /deploy` - Line ~574 (handles single & split deployments)
  - **Parameters**: `deploy_type` ('single' or 'split'), `git_url` or `frontend_url`+`backend_url`, optional `project_id`, optional `component_type`
  - **Split Flow**: Line 642-647 - Uses `project_id` as `parent_id` if provided, calls `run_split_deployment()`
  - **Single Flow**: Line 648-680 - Reuses existing deployment if `project_id` provided without `component_type`, or deploys as child component if `component_type` provided
  - **Component Deployment**: Line 667-668 - When `component_type` provided, uses `project_id` as `parent_id` for child deployment
  - **Environment**: Loads user env vars into temp directory as `frontend.env` and `backend.env` (lines 622-636)
- **List Deployments**: `GET /deployments` - Line ~908 (filters out child components with `parent_project_id IS NULL`)
- **Get Project Components**: `GET /projects/{project_id}/components` - Line ~969 (returns frontend/backend children)
- **Delete Project**: `DELETE /projects/{project_id}` - Line ~1204
  - **Cascade Deletion**: Now deletes all child components (containers, images, env vars, DB records)
  - **Split Repo Support**: Stops/removes all frontend/backend containers when deleting parent
- **Import Repository**: `POST /api/import` - Line ~745 (single repo, creates parent with git_url)
- **Import Multi-Repository**: `POST /api/import-split` - Line ~822 (frontend + backend, creates parent with `split::` git_url)
  - **Key Format**: Line 821 - Creates git_url as `split::{frontend_url}|{backend_url}`
  - **Status**: Sets status to `'imported_split'` (line 827)
  - **Naming**: Auto-generates app_name as `{fe_name}-{be_name}` (lines 816-819)
- **Authentication - Login**: `POST /api/auth/login` - Line ~278
  - **Request Format**: JSON body with Pydantic model `UserLogin` (username, password)
  - **NOT form data**: Endpoint expects `Content-Type: application/json`
  - **Request Body**: `{"username": "string", "password": "string"}`
  - **Response**: Returns `{"access_token": "...", "token_type": "bearer", "username": "..."}`
  - **Token Expiry**: 30 minutes (line 299)
  - **Auth**: No authentication required (public endpoint)
- **Authentication - Register**: `POST /api/auth/register` - Line ~316
  - **Request Format**: JSON body with Pydantic model `UserRegister` (username, email, password)
  - **Request Body**: `{"username": "string", "email": "string", "password": "string"}`
  - **Response**: Returns `{"message": "User created successfully"}`
  - **Auth**: No authentication required (public endpoint)
- **User Profile**: `GET /api/user/profile` - Line ~462 (returns user data including avatar_url)
- **Update Profile**: `PUT /api/user/profile` - Line ~473 (handles avatar upload, password change, profile updates)
  - **Avatar Storage**: Saves to `uploads/avatars/` (NOT `static/avatars/` to prevent deletion on build)
  - **Avatar URL**: Returns `/avatars/{user_id}_{random}.{ext}` format
  - **Avatar Serving**: FastAPI mounts `/avatars` from `uploads/avatars/` directory
- **Environment Variables API**: `GET /api/env-vars` - Line ~383 (get vars for current project)
- **Environment Variables API**: `POST /api/env-vars` - Line ~409 (save vars for current project)
- **Environment Variable Detection**: `GET /api/env-vars/detect` - Line ~461
  - **Path**: `/api/env-vars/detect` (full path, no routing conflicts)
  - **Request**: Query parameters (`?frontend_url=...&backend_url=...` or `?git_url=...`)
  - **Parameters**: `frontend_url`, `backend_url`, or `git_url` (for single repo)
  - **Authentication**: Requires Bearer token (`current_user: User = Depends(get_current_user)`)
  - **Functionality**: Clones repos to temp directory, scans code for env var patterns, returns suggestions
  - **Timeout**: 60 seconds per git clone operation
  - **Helper Function**: `_detect_env_from_repo()` - Line ~523
    - **Patterns**: process.env, os.getenv, os.environ, ${VAR}, env()
    - **Config Files**: next.config, .env.example, package.json, settings.py, etc.
    - **Filter**: Ignores common vars (NODE_ENV, PATH, HOME, etc.)
    - **Priority**: Vars from config files get higher priority (10 vs 5)
  - **Response**: `{"suggestions": {"VAR_NAME": {"detected_from": "file", "source": "process.env", "component": "frontend", "priority": 10}}}`
  - **Error Handling**: Returns empty suggestions dict on error (doesn't fail deployment)

### Deployment Logic (simple_pipeline.py)
- **Main Pipeline**: `run_deployment_pipeline()` - Line ~778 (handles single deployments)
- **Split Deployment**: `run_split_deployment()` - Line ~1096 (deploys frontend + backend)
- **Node.js Deployment**: `handle_node_project_deployment()` - Line ~609 (auto-generates Dockerfile for Node/Next.js)
  - **Detection**: Checks for package.json, detects framework (Next.js vs generic Node)
  - **Env Var Validation**: Lines 667-683 - Collects vars from next.config, warns if missing but doesn't fail
  - **Dockerfile Generation**: Creates multi-stage Dockerfile for Next.js or single-stage for generic Node
  - **Build Strategy**: Uses npm run build or npx next build
  - **Start Command**: Uses npm run start or npx next start
  - **Key Fix**: No longer fails when env vars are missing - warns and continues (line 683)
- **Parent Project Creation**: Inside `run_split_deployment()` - Line ~1114 (creates parent if `parent_project_id` is None)
  - **Naming**: Uses `{fe_name}-{be_name}` from extracted repo names
  - **Git URL**: Creates `split::{frontend_url}|{backend_url}` format (line 1119)
  - **Database Fields**: Sets `parent_project_id=None`, `component_type=None` (line 1131)
  - **Commit**: Immediately commits and refreshes to get parent ID (lines 1133-1136)
- **Child Deployment**: Calls `run_deployment_pipeline()` with `parent_project_id` and `component_type` (lines 1141, 1148)
- **Child Lookup/Update**: Inside `run_deployment_pipeline()` - Lines 831-861
  - **When `parent_project_id` + `component_type` provided**: Searches for existing child by parent + type
  - **If found**: Reuses existing child deployment, updates git_url and status
  - **If not found**: Creates new child deployment linked to parent
  - **Key Fix**: Allows individual Frontend/Backend redeployment without losing parent relationship
- **Deployment Order**: Backend first (line 1141), then frontend (line 1148)
- **URL Validation**: `validate_git_url()` - Line ~27
- **Repo Name Extraction**: `extract_repo_name()` - Line ~63

### Database Models (login.py)
- **User Model**: Line ~6 - Authentication, profile, tokens
- **Deployment Model**: Line ~22 - Container deployments with parent_project_id, component_type
- **EnvironmentVariable Model**: Line ~53 - User env vars per project

### Database Migrations (database.py)
- **Table Creation**: `create_db_and_tables()` - Line ~14
- **Column Migrations**: Lines ~25-39 - Adds app_name, updated_at, user_id, parent_project_id, component_type

## Split Repository Feature

### Database Schema
- **Parent Project**: Deployment with `parent_project_id = None`, `component_type = None`
- **Frontend Component**: Deployment with `parent_project_id = parent_id`, `component_type = 'frontend'`
- **Backend Component**: Deployment with `parent_project_id = parent_id`, `component_type = 'backend'`

### How Multi-Repositories Work (formerly "Split Repos")
- **User-Facing Name**: "Multi-Repository (Frontend + Backend)"
- **Internal Code**: Still uses "split" for API compatibility (deploy_type='split', split:: format, etc.)
1. **Import**: User imports via `/api/import-split` - creates parent with status 'imported_split' and git_url='split::{frontend}|{backend}'
2. **Deploy**: User clicks "Deploy All" - uses `/deploy` with `deploy_type='split'` which calls `run_split_deployment()`
3. **Deploy Process**: `run_split_deployment()` creates/uses parent, then deploys backend then frontend as children
4. **Display**: Dashboard shows only parent projects (`parent_project_id IS NULL` filter)
5. **Details**: Configuration page shows components via `/projects/{id}/components` endpoint
6. **Deletion**: Deleting parent now cascades to all children (containers, images, env vars, DB records)

### Multi-Repository Detection (Critical)
- **Most Reliable**: `git_url.startsWith('split::')` - works before AND after deployment
- **Status Fallback**: `status === 'imported_split'` - only before deployment
- **Database Integrity**: Parent MUST have `parent_project_id = NULL` and `component_type = NULL`
- **Children**: Must have `parent_project_id = parent.id` and `component_type = 'frontend'|'backend'`
- **Import Format**: `/api/import-split` creates git_url = `split::{frontend_url}|{backend_url}` (line 821)
- **Deploy Format**: `run_split_deployment()` uses same format when creating parent (line 1119)

### Deploy Page Behavior
- **New Deploy** (from "+ New Deploy" button): Shows dropdown to choose single/multi, `currentProject` is null
- **Existing Multi-Repository Project**: Shows multi layout (frontend/backend inputs + "Deploy All") without dropdown, shows components section if both deployed
- **Existing Single Project**: Shows single URL input without dropdown
- **Key Fix**: Deploy page is ALWAYS shown when clicking on a project (not configuration or components page)
- **Components Section**: Only shown on deploy page, above "Deploy New Application" card, when both frontend and backend are deployed
- **Critical Bug Fixed**: Multi-repo showing single-repo form after deployment
  - **Root Cause**: Stale `currentProject` object after deployment, missing parent project in database
  - **Solution**: Navigation reloads fresh data, ensure parent has `git_url` in `split::` format

## CSS Class Reference

### Buttons
- `.btn-primary` - Green primary button
- `.btn-secondary` - Gray secondary button  
- `.btn-dark` - Dark blue button (used for "Open Site")
- `.btn-danger` - Red button (delete actions)
- `.btn-delete` - Delete button on project cards (line ~2109)
- `.btn-block` - Full-width button

### Modals
- **All Modal CSS**: `frontend/src/css/styles.css` - Lines ~1217-1566
- **Modal Overlay**: `.modal-overlay` (line ~1245) - Fixed overlay backdrop
- **Modal Content**: `.modal-content` (line ~1230) - Base modal container
- **Enhanced Modal**: `.modal-content.enhanced` (line ~1324) - Wider modal variant

#### Delete Confirmation Dialog
- **JS Function**: `frontend/src/js/app.js` - `showDeleteConfirmation()` at line ~182
- **CSS**: `.delete-confirmation-modal` (line ~1258), `.delete-confirmation-actions` (line ~1286)

#### Split Import Dialog
- **JS Function**: `frontend/src/js/app.js` - `showSplitImportDialog()` at line ~2239
- **CSS Classes**: Lines ~1373-1474
  - `.split-import-modal-center` - Centered header section
  - `.split-import-icon-wrapper` - Icon container
  - `.split-import-repo-info` - Repository details container
  - `.split-import-actions` - Action buttons container

#### Project Name Modal
- **JS Function**: `frontend/src/js/app.js` - `openProjectNameModal()` at line ~1519
- **CSS Classes**: Lines ~1476-1566
  - `.project-name-modal-header` - Header section
  - `.project-name-modal-form-group` - Input form group
  - `.project-name-modal-actions` - Action buttons container
  - `.cancel-name-btn`, `.save-name-btn` - Button styles

#### Project Logs Modal
- **JS Function**: `frontend/src/js/app.js` - `showProjectLogsModal()` at line ~889
- **CSS**: `.logs-modal` (line ~1678), `.modal-header`, `.modal-body`, `.modal-footer`

### Project Cards
- `.project-card` - Individual project card container
- `.project-header` - Card header with icon and status
- `.project-info` - Card body with name and metadata
- `.project-footer` - Footer with action buttons
- `.project-status` - Status badge (RUNNING, IMPORTED, etc.)

## File Structure

```
Devops_Butler/
├── orchestrator.py          # FastAPI main app
├── simple_pipeline.py       # Deployment logic
├── login.py                 # Database models
├── database.py              # DB setup & migrations
├── docker_build.py          # Docker image building
├── docker_run.py            # Container management
├── frontend/
│   ├── src/
│   │   ├── index.html       # Main SPA
│   │   ├── js/
│   │   │   └── app.js       # All frontend logic
│   │   └── css/
│   │       └── styles.css   # All styles
│   └── package.json
├── static/                  # Built frontend (served by FastAPI)
├── uploads/
│   └── avatars/             # User profile pictures (not deleted on build)
└── icons/                   # Application icons (logo.png, devops.png)
```

## Key Concepts

### Project Status Values
- `'running'` - Container is currently running
- `'imported'` - Repository imported but not deployed
- `'imported_split'` - Split repo imported but not deployed
- `'success'` - Deployment succeeded (may be stopped)
- `'failed'` - Deployment failed

### Component Types
- `None` - Standalone or parent project
- `'frontend'` - Frontend component of split repo
- `'backend'` - Backend component of split repo

### Git URL Formats
- Normal: `https://github.com/user/repo.git`
- Split: `split::{frontend_url}|{backend_url}`

## Common Tasks

### Add New API Endpoint
1. Add route in `orchestrator.py`
2. Add authentication if needed: `current_user: User = Depends(get_current_user)`
3. Use database session: `with Session(engine) as session:`

### Modify Frontend Page
1. Edit HTML in `frontend/src/index.html`
2. Edit logic in `frontend/src/js/app.js`
3. Edit styles in `frontend/src/css/styles.css`
4. Run `cd frontend && npm run build` to compile

### Change Database Schema
1. Update model in `login.py`
2. Add migration in `database.py` `create_db_and_tables()` function
3. Server auto-applies on restart

### API Authentication & Request Formats
- **Login/Register**: Expect JSON body (`Content-Type: application/json`), NOT form data
  - Login: `POST /api/auth/login` with `{"username": "...", "password": "..."}`
  - Register: `POST /api/auth/register` with `{"username": "...", "email": "...", "password": "..."}`
- **Authenticated Endpoints**: Most API endpoints require Bearer token in `Authorization` header
  - Format: `Authorization: Bearer {access_token}`
  - Token obtained from login endpoint, valid for 30 minutes
- **Query Parameters**: Some endpoints use query params (e.g., `/api/env-vars/detect?frontend_url=...`)
- **Form Data**: Deployment endpoint (`/deploy`) uses `Form` data, not JSON

### Debugging
- Backend logs: Terminal running `orchestrator.py`
- Frontend console: Browser DevTools
- Database: `deployments.db` SQLite file
- **API Testing**: Use curl with proper Content-Type headers:
  - JSON: `curl -X POST -H "Content-Type: application/json" -d '{"username":"..."}' ...`
  - Auth: `curl -H "Authorization: Bearer {token}" ...`

### Multi-Repository Flow (Complete) - User-facing name for what was "Split Repository"
1. **User imports multi-repo** → `/api/import-split` creates parent with:
   - `git_url = "split::{frontend_url}|{backend_url}"` (line 821)
   - `status = 'imported_split'` (line 827)
   - `parent_project_id = None`, `component_type = None`
   - Returns project_id
2. **User clicks "Deploy All"** → Frontend sends to `/deploy`:
   - `deploy_type = 'split'`, `frontend_url`, `backend_url`, `project_id`
   - Backend receives `project_id` as `parent_id` (line 646)
   - Calls `run_split_deployment(parent_project_id=parent_id)`
3. **Backend deployment** → `run_split_deployment()` at line 1096:
   - Checks if `parent_project_id` is None → creates parent if needed (line 1115)
   - Creates parent with `split::` format git_url (line 1119)
   - Deploys backend first as child (line 1141) with `component_type='backend'`
   - Deploys frontend second as child (line 1148) with `component_type='frontend'`
   - Children link to parent via `parent_project_id`
4. **Individual Frontend/Backend deployment** → User clicks "Deploy Frontend" or "Deploy Backend":
   - Frontend sends to `/deploy`: `deploy_type='single'`, `component_type='frontend'|'backend'`, `project_id=parent`
   - Backend receives `project_id` as parent and `component_type` (line 667-668)
   - Calls `run_deployment_pipeline()` with `parent_project_id` and `component_type` (lines 673-680)
   - Pipeline finds existing child by `parent_project_id + component_type` or creates new child (lines 831-861)
   - Updates existing child if found, otherwise creates new child linked to parent
5. **Frontend displays** → Dashboard loads:
   - `/deployments` returns only parents (`parent_project_id IS NULL`)
   - Multi-repos detected by `git_url.startsWith('split::')`
   - Deploy page shows multi form with pre-filled URLs
   - Config page shows components section with frontend/backend cards
6. **User deletes multi-repo** → `DELETE /projects/{parent_id}`:
   - Finds all children where `parent_project_id = parent_id`
   - Stops and removes all child containers
   - Deletes all child images
   - Deletes all child env vars
   - Deletes all child DB records
   - Then deletes parent

